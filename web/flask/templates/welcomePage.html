<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Online Location-based Business Recommendation</title>

    <!-- Bootstrap Core CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/stylish-portfolio.css') }}" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="{{ url_for('static', filename='font-awesome/css/font-awesome.min.css') }}" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="{{ url_for('static', filename='css/chosen.css') }}" >

    <style type="text/css">.gm-style .gm-style-iw{font-weight:300;font-size:13px;overflow:hidden; color:black}
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>

    <script type="text/javascript">// <![CDATA[
        function loading(){
            console.log("loading")
            $("#loading").show();
            $("#content").hide();
        }
// ]]></script>
    <script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

    <script type=text/javascript>
    function recommendDistance() {
    console.log("Get Recommended Distance");
    if ($(".chosen-select").val() != '' && $(".chosen-select").val() != null) {
        keywordsVar = $(".chosen-select").val().join("-----");
    }
    else {
        alert("Please select at least one category");
        keywordsVar = '';
    }
      $.getJSON($SCRIPT_ROOT + '/_recommend_distance', {
        keywords: keywordsVar,
      }, function(data) {
        $("#distance").val(parseInt(data.result));
      });
      return false;
    }
</script>



</head>
<body>

<!-- Navigation -->

<a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
<nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
        <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
        <li class="sidebar-brand">
            <a href="#top"  onclick = $("#menu-close").click(); >Online Recommendation Tool</a>
        </li>
        <li>
            <a href="#top" onclick = $("#menu-close").click(); >Home</a>
        </li>
        <li>
            <a href="#about" onclick = $("#menu-close").click(); >About</a>
        </li>
        <li>
            <a href="#recommender" onclick = $("#menu-close").click(); >Online Recommender</a>
        </li>
        <li>
            <a href="#contact" onclick = $("#menu-close").click(); >Contact</a>
        </li>
    </ul>
</nav>

<!-- Header -->
<header id="top" class="header">
    <div class="text-vertical-center">
        <h1>Online Location-based Business Recommendation</h1>
        <h3>This tool recommends the entrepreneurs where are the best location to build their businesses</h3>
        <br>
        <a href="#about" class="btn btn-dark btn-lg">Find Out More</a>
    </div>
</header>

<!-- About -->
<section id="about" class="about  bg-primary">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-offset-2">
                <h2 class="text-center">How does it work?</h2>
                <p class="lead">By using the <a href="http://www.yelp.com/dataset_challenge/">Yelp's dataset</a> we provide to the entrepreneurs recommendations on where to build their next businesses.</p>
                <p>We have identified in this <a href="http://www.yelp.com/dataset_challenge/">Yelp's dataset</a> the key factors for a good business location according to its categories.</p>
                <p>By looking at what are the current missing spots we will recommend you where to start your new business. Our current recommendation apply only for the city of Phoenix, Arizona.</p>
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container -->
</section>




<!-- Services -->
<!-- The circle icons use Font Awesome's stacked icon classes. For more information, visit http://fontawesome.io/examples/ -->
<section id="recommender" class="services">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-offset-2">
                <h2 class="text-center">Our Recommender Tool</h2>
                <div class="row">

                    <form action="{{ url_for('results') }}" method=post>
                        <div class="form-group">
                            <label for="keywords">Please enter the keywords to describe your business.</label> <br />

                            <select name="keywords" id="keywords" data-placeholder="Choose the categories..." class="chosen-select" multiple style="width:500px;" tabindex="4">
                                {% for category in categories|sort(true, attribute=1) %}
                                {% if category[2] %}
                                <option selected>{{ category.0 }}</option>
                                {% else %}
                                <option>{{ category.0 }}</option>
                                {% endif %}
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="numberOfOpportunities">Please enter the number of opportunities that you would like to see in the map.</label>
                            <input name="numberOfOpportunities" value="{{ numberOfOpportunities }}" type="number" class="form-control" id="numberOfOpportunities" placeholder="example: 10">
                        </div>

                        <div class="form-group">
                            <label for="distance">Please enter the maximum distance in meters that you want to have between your business and your competitors or other important businesses. By clicking on Recommend Me, our algorithm will select the best distance according to the keywords that you have selected before.</label>
                            <div style="display: inline;">
                                <input style="display: inline;" name="distance" value="{{distance}}" type="number" class="form-control" id="distance" placeholder="example: 150">
                                <button style="margin-bottom: 3px;" class="btn btn-info btn-default form-control" type="button" onclick="recommendDistance()">Recommend Me</button>
                            </div>
                        </div>

                        <input class="btn btn-default"  onclick="loading();" style="color: black;" type="submit" />
                    </form>

                    <script src="{{ url_for('static', filename='js/chosen.jquery.js') }}"   type="text/javascript"></script>
                    <script type="text/javascript">
    var config = {
      '.chosen-select'           : {},
    }
    for (var selector in config) {
      $(selector).chosen(config[selector]);
    }

  </script>





                </div>
                <!-- /.row (nested) -->
            </div>
            <!-- /.col-lg-10 -->
        </div>
        <!-- /.row -->
    </div>
    <div id="loading">Please wait, it can take up to 15 seconds to find the best opportunities. <br />
        <img src="{{ url_for('static', filename='img/loader.gif') }}"></div>
    {% if businessOpportunities %}
    <div id="content">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-offset-2">
                    <hr />
                    <p>
                        We have selected the {{ numberOfOpportunities }} best areas to build your business. We recommend to build your business close to the businesses of these categories:
                    <ul>
                        {% for uniqueMatchingCategory in uniqueListOfMatchingCategories %}
                        <li>
                            {{ uniqueMatchingCategory }}
                        </li>
                        {% endfor %}

                    </ul>
                    </p>
                    <p>
                        We indicate in the map below your potential competitors with the warning icon <img src="static/img/warning.png" />.
                        A potential competitor can also be an advantage for your company because the aggregation of competitors can increase your number of customers. <br />
                        The businesses that are good complementors for your business are indicated with a star icon <img src="static/img/star.png" />
                    </p>
                </div>
            </div>
        </div>

        <script type="text/javascript">
document.getElementById('recommender').scrollIntoView()
    </script>
        <hr />

        <script src="http://maps.google.com/maps/api/js?sensor=false"
                type="text/javascript"></script>
        <script type="text/javascript" src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/src/markerclusterer.js"></script>


        <div id="map" style="position: relative;
    height: 600px;
    width: 100%;
    color: back;
    "></div>


        <script type="text/javascript">
  {% set i = 0 %}
{% for clusterID in businessOpportunities %}
    {% set i = i + 1 %}
           var locations{{i}} = [
           {% for businessID in businessOpportunities[clusterID] %}
                    ['Business of category: "{{ businessOpportunities[clusterID][businessID]["categories"] }}" called "{{ businessOpportunities[clusterID][businessID]["name"] }}". This business has a star rating of {{ businessOpportunities[clusterID][businessID]["stars"] }}/5 on average with {{ businessOpportunities[clusterID][businessID]["review_count"] }} reviews',
                    {{ businessOpportunities[clusterID][businessID]["latitude"] }}, {{  businessOpportunities[clusterID][businessID]["longitude"] }},
                    '{{ businessOpportunities[clusterID][businessID]["icon"] }}'
                    ] ,
           {% endfor %}
            ];
{% endfor %}

{% set i = 0 %}


        var markers = [];

    var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 9,
    center: new google.maps.LatLng(33.5, -112),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    });


    var infowindow = new google.maps.InfoWindow();


{% set j = 0 %}
{% for clusterID in businessOpportunities %}
    {% set j = j + 1 %}
    randomColor{{j}} = "#" + Math.random().toString(16).slice(2, 8)

    var marker{{j}}, i, center;
        for (i = 0; i < locations{{j}}.length; i++) {
            center = new google.maps.LatLng(locations{{j}}[i][1], locations{{j}}[i][2]);
            marker{{j}} = new google.maps.Marker({
                position: center,
                map: map,
                icon: locations{{j}}[i][3]

            });
        markers.push(marker{{j}});
            var circle = new google.maps.Circle({
                center: center,
                map:map,
                radius: {{ distance }},
                strokeColor: randomColor{{j}},
                strokeOpacity:0.5,
                strokeWeight: 2,
                fillColor: randomColor{{j}}
            });
            circle.bindTo('center',marker{{j}},'position');
            google.maps.event.addListener(marker{{j}}, 'click', (function(marker{{j}}, i) {
                return function() {
                    infowindow.setContent(locations{{j}}[i][0]);
                    infowindow.open(map, marker{{j}});
                };
            })(marker{{j}}, i));
        }

{% endfor %}




</script>

        <div class="container">

            <div class="row">
                <div class="col-lg-8 col-md-offset-2">
                    <div class="text-center">
                        <h2>More information</h2>

                    </div>
                    <p>
                        There are {{ numberOfOpportunities }} opportunities according to your criterias
                    </p>
                    <p>
                    <ul>
                        {% for matchingCategory in matchingCategories %}
                        <li>The category <strong>{{ matchingCategory[3] }}</strong> is associated with the category <strong>{{ matchingCategory[0] }}</strong> and has a median distance of <strong>{{ matchingCategory[1] }} meters</strong> <br /></li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
</section>

















<!-- Footer -->
<footer class="bg-primary">
    <div id="contact" class="container  ">
        <div class="row">
            <div class="col-lg-8 col-md-offset-2 text-center">
                <h4><strong>Online Location-based Business Recommendation</strong>
                </h4>
                <p>This website is a part of the project "Recommending Ideal Location for Business based on Yelp Dataset". <br />
                    The project try to answers the challenges that can be solved using the <a href="http://www.yelp.com/dataset_challenge/">Yelp's dataset</a> for the round five of the contest.
                </p>
                <p>
                    Michael Susplugas
                </p>
                <p> {% if loadingTime %}
                    Loaded in {{loadingTime}} seconds
                    {% endif %}
                </p>

            </div>
        </div>
    </div>
</footer>

<!-- Bootstrap Core JavaScript -->
<script href="{{ url_for('static', filename='js/bootstrap.min.js') }}" ></script>

<!-- Custom Theme JavaScript -->
<script>
    // Closes the sidebar menu
    $("#menu-close").click(function(e) {
        e.preventDefault();
        $("#sidebar-wrapper").toggleClass("active");
    });

    // Opens the sidebar menu
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#sidebar-wrapper").toggleClass("active");
    });

    // Scrolls to the selected menu item on the page
    $(function() {
        $('a[href*=#]:not([href=#])').click(function() {
            if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') || location.hostname == this.hostname) {

                var target = $(this.hash);
                target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                if (target.length) {
                    $('html,body').animate({
                        scrollTop: target.offset().top
                    }, 1000);
                    return false;
                }
            }
        });
    });
    </script>

</body>

</html>